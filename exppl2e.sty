% \iffalse meta-comment
%
% This is file `exppl2e.sty', for experimental pLaTeX2e.
%
% Copyright (c) 2016-2017 Japanese TeX Development Community
%
% This file is part of the pLaTeX2e system (community edition).
% -------------------------------------------------------------
%
% ====================================================================
%   開発者の方へ (2016-06-29 aminophen)
%
% このファイルのコードを実際にカーネルに取り入れるとき、単純にカット・
% ペーストで dtx ファイルへ挿入します。ペーストした dtx ファイルから
% ltx / sty ファイル等を生成したあとには、必ず
%   * フォーマット作成に使われる ltx ファイルが意図どおり変更されたか
%   * platexrelease.sty に新たなブロックが一つだけ追加されたか
%     （例外的に 0000/00/00 の日付が含まれる場合は、ブロックが二つか）
% を確認します。
% ====================================================================
%
%%%%%%%% ^^A driver-like trick using catcode difference
%
% This file `exppl2e.sty' is a normal LaTeX package, so
%   \RequirePackage{exppl2e}
% and
%   \usepackage{exppl2e}
% works. However, it can also be typeset alone:
%   platex exppl2e.sty
% for convenience.
%
%<*hack>
\ifx\undefined\@undefined\relax
% case 1: This file must be a normal package
  \NeedsTeXFormat{pLaTeX2e}
  \ProvidesPackage{exppl2e}
                [2017/04/08 v1.0k Experimental pLaTeX2e features]
  \PackageWarningNoLine{exppl2e}{%
      This is the unstable, experimental part of pLaTeX2e.\MessageBreak
      This package may contain:\MessageBreak
       * future patches to pLaTeX\MessageBreak
       * experimental new features\MessageBreak
      Please note that these can be removed without any\MessageBreak
      announcement at some point in the future, and may\MessageBreak
      also have some critical bugs. We appreciate any\MessageBreak
      reports and comments. Thank you for your cooperation}
  \RequirePackage[latest]{platexrelease}
\else
% case 2: This file pretends to be a document
  \documentclass{jltxdoc}
  \title{Experimental p\LaTeXe}
  \author{Japanese \TeX\ Development Community}
  \begin{document}
    \maketitle
    \DocInput{exppl2e.sty}
  \end{document}
\fi %     ^^A   In case 2, this \fi comes after \end{document}
%</hack>  ^^A   so it has no effect.
% \fi     ^^A   This \fi corresponds to \iffalse, and another
%         ^^A   \fi is required for \ifx, see below;)
%
%%%%%%%% ^^A trick end
%
% \fi
%
%
% \emph{注意}：これはExperimentalなp\LaTeXe{}、すなわちunstableな
% 実験的p\LaTeX{}コードを提供するパッケージです。
%
%
% \section{このパッケージの目的}
%
% コードの不用意な改変は即エンバグにつながり、利用者の多いp\LaTeX{}や
% up\LaTeX{}では特に影響が大きいと思われます。その一方で、unstableなもの
% もなるべく手軽にテストして頂きたいとも考えます。
%
% このパッケージ\file{exppl2e.sty}は、カーネル(stable)に将来含める
% ことを想定したunstableな実験的コードを配布することを目的に作成しました。
% テストをよろしくお願いします。
%
%
% \section{実験的コードの読みこみかた}
%
% デフォルトの配布では、実験的なコードは無効化されています。
% 実験的なp\LaTeXe{}を試したい場合は、以下のいずれかの方法を使います：
%
% \subsection{少しだけ試してみたい場合}
%
% パッケージ\file{exppl2e.sty}を読み込みます。ただし、|\usepackage|命令
% を使うのではなく、文書クラスより\emph{前}に読み込んでおくのが無難です。
%\begin{verbatim}
%   \RequirePackage{exppl2e}
%   \documentclass{article}
%\end{verbatim}
%
% \subsection{常に実験的コードを使用したい場合}
%
% このパッケージと一緒にインストールされる新しいp\LaTeX{}は、お使いの
% \texttt{platex}などのプログラムが見つけることのできる場所（簡単なの
% はカレントディレクトリ、あるいは|$TEXMFLOCAL/tex|以下の適切な場所）
% に\file{platex.cfg}というファイルがあれば、起動時にそれを読み込み
% ます。この機能を利用すると、以下の内容の\file{platex.cfg}を用意し
% ておくだけで、自動的に毎回\file{exppl2e.sty}が読み込まれます。
%\begin{verbatim}
% \RequirePackage{exppl2e}
%\end{verbatim}
%
%
% \section{このドキュメントについて}
%
% コミュニティ版p\LaTeX{}が配布するほかのstyファイルとは異なり、
% 実質的には\file{exppl2e.sty}はdtxファイルと同等です。すなわち、
% コードと一緒にdtx互換ドキュメントが含まれています。このドキュメント
% を組版するには
%\begin{verbatim}
%   # platex exppl2e.sty
%\end{verbatim}
% を実行します。
%
%
% \section{コード}
%
% ここからp\LaTeXe{}のexperimentalコード本体です。
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{PDFのブックマークとアクセント文字}
%
% \begin{macro}{\pltx@isletter}
% \changes{v???}{????/??/??}{PDFのしおりにアクセント文字が含まれる場合に対応}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{????/??/??}{\pltx@isletter}
%<platexrelease>                   {Support PD1 encoding}%
%<*pldefs|platexrelease>
\def\pltx@mark{\pltx@mark@}
\let\pltx@scanstop\relax
\long\def\pltx@cond#1\fi{%
  #1\expandafter\@firstoftwo\else\expandafter\@secondoftwo\fi}
\def\pltx@pdfencA{PD1}
\def\pltx@composite@chkenc{%
  \ifx\pltx@pdfencA\f@encoding
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi}
\long\def\pltx@isletter#1{%
  \expandafter\pltx@isletter@i#1\pltx@scanstop}
\long\def\pltx@isletter@i#1\pltx@scanstop{%
  \pltx@cond\ifx\pltx@mark#1\pltx@mark\fi{\@firstoftwo}%
    {\pltx@isletter@ii\pltx@scanstop#1\pltx@scanstop{}#1\pltx@mark}}
\long\def\pltx@isletter@ii#1\pltx@scanstop#{%
  \pltx@cond\ifx\pltx@mark#1\pltx@mark\fi%
    {\pltx@isletter@iii}{\pltx@isletter@iv}}
\long\def\pltx@isletter@iii#1\pltx@mark{\@secondoftwo}
\long\def\pltx@isletter@iv#1#2#3\pltx@mark{%
  \pltx@cond\ifx\pltx@mark#3\pltx@mark\fi{%
    \pltx@cond{\ifnum0\ifcat A\noexpand#21\fi\ifcat=\noexpand#21\fi>\z@}\fi
      {\@firstoftwo}{\pltx@composite@chkenc}%
  }{\pltx@composite@chkenc}}
%</pldefs|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{2016/06/10}{\pltx@isletter}
%<platexrelease>                   {Added \pltx@isletter}%
%<platexrelease>\def\pltx@mark{\pltx@mark@}
%<platexrelease>\let\pltx@scanstop\relax
%<platexrelease>\long\def\pltx@cond#1\fi{%
%<platexrelease>  #1\expandafter\@firstoftwo\else\expandafter\@secondoftwo\fi}
%<platexrelease>\long\def\pltx@isletter#1{%
%<platexrelease>  \expandafter\pltx@isletter@i#1\pltx@scanstop}
%<platexrelease>\long\def\pltx@isletter@i#1\pltx@scanstop{%
%<platexrelease>  \pltx@cond\ifx\pltx@mark#1\pltx@mark\fi{\@firstoftwo}%
%<platexrelease>    {\pltx@isletter@ii\pltx@scanstop#1\pltx@scanstop{}#1\pltx@mark}}
%<platexrelease>\long\def\pltx@isletter@ii#1\pltx@scanstop#{%
%<platexrelease>  \pltx@cond\ifx\pltx@mark#1\pltx@mark\fi%
%<platexrelease>    {\pltx@isletter@iii}{\pltx@isletter@iv}}
%<platexrelease>\long\def\pltx@isletter@iii#1\pltx@mark{\@secondoftwo}
%<platexrelease>\long\def\pltx@isletter@iv#1#2#3\pltx@mark{%
%<platexrelease>  \pltx@cond\ifx\pltx@mark#3\pltx@mark\fi{%
%<platexrelease>    \pltx@cond{\ifnum0\ifcat A\noexpand#21\fi\ifcat=\noexpand#21\fi>\z@}\fi
%<platexrelease>      {\@firstoftwo}{\@secondoftwo}%
%<platexrelease>  }{\@secondoftwo}}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@text@composite@x}
% \changes{v???}{????/??/??}{v1.6eでいったんパッチを除去したコードを再導入}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{????/??/??}{\@text@composite@x}
%<platexrelease>                   {Fix for non-zero baselineshift}%
%<*pldefs|platexrelease>
\def\@text@composite@x#1#2{%
  \ifx#1\relax
    #2%
  \else\pltx@isletter{#1}{#1}{%
    \begingroup
    \setbox\z@\hbox\bgroup%
      \ybaselineshift\z@\tbaselineshift\z@
      #1%
      \g@tlastchart@\@tempcntb
      \xdef\pltx@composite@temp{\noexpand\@tempcntb=\the\@tempcntb\relax}%
      \aftergroup\pltx@composite@temp
    \egroup
%    \end{macrocode}
%    \begin{macrocode}
    \ifnum\@tempcntb<\z@
      \@tempdima=\iftdir
          \ifmdir
            \ifmmode\tbaselineshift\else\ybaselineshift\fi
          \else
            \tbaselineshift
          \fi
        \else
          \ybaselineshift
        \fi
      \@tempcntb=\@cclvi
    \else\@tempdima=\z@
    \fi
%    \end{macrocode}
% アクセントが付く「本体の文字」が欧文文字と推測される場合には、
% 一旦数式モードに入ることによって\cs{xkanjiskip}が前後に入るようにします。
% 必要なら、数式モードの前後に\cs{null}を補って\cs{xkanjiskip}の挿入を抑制します。
%    \begin{macrocode}
    \ifnum\@tempcntb<\@cclvi
      \ifnum\@tempcntb>\m@ne\ifnum\@tempcntb<\@cclvi
        \ifodd\xspcode\@tempcntb\else\leavevmode\hbox{}\fi
      \fi\fi
      \begingroup\mathsurround\z@$%
        \ifx\textbaselineshiftfactor\@undefined\else
          \textbaselineshiftfactor\z@\fi
        \box\z@
      $\endgroup%
      \ifnum\@tempcntb>\m@ne\ifnum\@tempcntb<\@cclvi
        \ifnum\xspcode\@tempcntb<2\hbox{}\fi
      \fi\fi
%    \end{macrocode}
%    \begin{macrocode}
    \else
      \ifdim\@tempdima=\z@{\ybaselineshift\z@\tbaselineshift\z@#1}%
      \else\leavevmode\lower\@tempdima\box\z@\fi
    \fi
    \endgroup}%
  \fi
}
%</pldefs|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{脚注の合印直後での改行を許可}
%
% p\LaTeXe{}カーネル(2016/09/03)に導入したため削除。
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{支柱}
%
% \subsubsection{支柱}
% 行間の調整などに用いる支柱です。
% 支柱のもととなるボックスの大きさは、フォントサイズが変更されるたびに、
% |\set@fontsize|コマンドによって変化します。
%
% フォントサイズが変更されたときに、|\set@fontsize|コマンドで更新されます。
%
% 従来、横組ボックス用の支柱は|\strutbox|で、高さと深さが7対3となっていました。
% これはp\LaTeX{}単体では問題になりませんでしたが、海外製の\LaTeX{}パッケージを
% 縦組で使用した場合に、意図しない幅や高さが取得されることがありました。
% この不都合を回避するため、コミュニティ版p\LaTeX{}では次の方法をとります。
% \begin{itemize}
% \item |\ystrutbox|（新設）：高さと深さが7対3の横組ボックス用の支柱
% \item |\tstrutbox|：高さと深さが5対5の縦組ボックス用の支柱
% \item |\zstrutbox|：高さと深さが7対3の縦組ボックス用の支柱
% \item |\strutbox|（仕様変更）：縦横のディレクションに応じて
%                     |\tstrutbox|または|\ystrutbox|に展開されるマクロ
% \end{itemize}
% すなわち、従来のp\LaTeX{}における|\strutbox|と同じ挙動を示すのが、
% 新設された|\ystrutbox|ということになります。
%
% \begin{macro}{\tstrutbox}
% \begin{macro}{\zstrutbox}
% |\tstrutbox|は高さと深さが5対5、
% |\zstrutbox|は高さと深さが7対3の支柱ボックスとなります。
% これらは縦組ボックスの行間の調整などに使います。
%    \begin{macrocode}
\newbox\tstrutbox
\newbox\zstrutbox
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\ystrutbox}
% |\ystrutbox|は高さと深さが7対3の横組ボックス用の支柱です。
% \changes{v1.6f}{2017/02/20}{\cs{ystrutbox}を追加}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\ystrutbox}
%<platexrelease>                   {Add \ystrutbox}%
%<*plcore|platexrelease>
\newbox\ystrutbox
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\ystrutbox}
%<platexrelease>                   {Add \ystrutbox}%
%<platexrelease>\let\ystrutbox\@undefined
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\strutbox}
% |\strutbox|は縦横両対応です。
% \changes{v1.6f}{2017/02/20}{\cs{strutbox}を縦横両対応に}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\strutbox}
%<platexrelease>                   {Add \strutbox}%
%<*plcore|platexrelease>
\def\strutbox{\iftdir\tstrutbox\else\ystrutbox\fi}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\strutbox}
%<platexrelease>                   {Add \strutbox}%
%<platexrelease>\newbox\strutbox % emulation purpose only
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\strut}
% ディレクションに応じて|\ystrutbox|と|\tstrutbox|を使い分けます。
% ^^A |\strutbox|は|\yoko|ディレクションで組まれていますので、
% ^^A 縦組ボックス内で|\unhcopy|をするとエラーとなります。
% 元々このマクロは\file{ltplain.dtx}で定義されています。
%
% \changes{v1.1c}{1995/08/24}{``\cs{centerling}~\cs{strut}''の幅がゼロに
% なってしまうのを修正}
% \changes{v1.3h}{1999/08/09}{縦組のとき、幅のあるボックスになってしまう
% のを修正}
% \changes{v1.6f}{2017/02/20}{\cs{strutbox}の代わりに\cs{ystrutbox}を使用}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\strut}
%<platexrelease>                   {Use \ystrutbox}%
%<*plcore|platexrelease>
\def\strut{\relax
  \ifydir
    \ifmmode\copy\ystrutbox\else\unhcopy\ystrutbox\fi
  \else
    \ifmmode\copy\tstrutbox\else\unhcopy\tstrutbox\fi
  \fi}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\strut}
%<platexrelease>                   {Use \ystrutbox}%
%<platexrelease>\def\strut{\relax
%<platexrelease>  \ifydir
%<platexrelease>    \ifmmode\copy\strutbox\else\unhcopy\strutbox\fi
%<platexrelease>  \else
%<platexrelease>    \ifmmode\copy\tstrutbox\else\unhcopy\tstrutbox\fi
%<platexrelease>  \fi}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\tstrut}
% \begin{macro}{\zstrut}
%    \begin{macrocode}
\def\tstrut{\relax\hbox{\tate
   \ifmmode\copy\tstrutbox\else\unhcopy\tstrutbox\fi}}
\def\zstrut{\relax\hbox{\tate
   \ifmmode\copy\zstrutbox\else\unhcopy\zstrutbox\fi}}
%    \end{macrocode}
% \end{macro}
% \end{macro}
%
% \begin{macro}{\ystrut}
% \changes{v1.6f}{2017/02/20}{\cs{ystrut}を追加}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\ystrut}
%<platexrelease>                   {Add \ystrut}%
%<*plcore|platexrelease>
\def\ystrut{\relax\hbox{\yoko
    \ifmmode\copy\ystrutbox\else\unhcopy\ystrutbox\fi}}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\ystrut}
%<platexrelease>                   {Add \ystrut}%
%<platexrelease>\let\ystrut\@undefined
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
%
%
% \begin{macro}{\set@fontsize}
% |\fontsize|コマンドの内部形式です。
% ベースラインの設定と、支柱の設定を行ないます。
%    \begin{macrocode}
%</plcore|trace>
%<platexrelease|trace>\plIncludeInRelease{2017/04/08}{\set@fontsize}
%<platexrelease|trace>                   {Construct \ystrutbox}%
%<*plcore|platexrelease|trace>
\def\set@fontsize#1#2#3{%
    \@defaultunits\@tempdimb#2pt\relax\@nnil
    \edef\f@size{\strip@pt\@tempdimb}%
    \@defaultunits\@tempskipa#3pt\relax\@nnil
    \edef\f@baselineskip{\the\@tempskipa}%
    \edef\f@linespread{#1}%
    \let\baselinestretch\f@linespread
    \def\size@update{%
      \baselineskip\f@baselineskip\relax
      \baselineskip\f@linespread\baselineskip
      \normalbaselineskip\baselineskip
%    \end{macrocode}
% ここで、ベースラインシフトの調整と支柱を組み立てます。
% \changes{v1.6f}{2017/02/20}{\cs{ystrutbox}を組み立てるように}
%    \begin{macrocode}
      \adjustbaseline
      \setbox\ystrutbox\hbox{\yoko
          \vrule\@width\z@
                \@height.7\baselineskip \@depth.3\baselineskip}%
      \setbox\tstrutbox\hbox{\tate
          \vrule\@width\z@
                \@height.5\baselineskip \@depth.5\baselineskip}%
      \setbox\zstrutbox\hbox{\tate
          \vrule\@width\z@
                \@height.7\baselineskip \@depth.3\baselineskip}%
%    \end{macrocode}
% フォントサイズとベースラインに関する診断情報を出力します。
%    \begin{macrocode}
%<*trace>
%    \ifnum \tracingfonts>\tw@
%      \ifx\f@linespread\@empty
%        \let\reserved@a\@empty
%      \else
%        \def\reserved@a{\f@linespread x}%
%      \fi
%      \@font@info{Changing size to\space
%            \f@size/\reserved@a \f@baselineskip}%
%      \aftergroup\type@restoreinfo
%    \fi
%</trace>
        \let\size@update\relax}}
%</plcore|platexrelease|trace>
%<platexrelease|trace>\plEndIncludeInRelease
%<platexrelease|trace>\plIncludeInRelease{0000/00/00}{\set@fontsize}
%<platexrelease|trace>                   {Construct \ystrutbox}%
%<platexrelease|trace>\def\set@fontsize#1#2#3{%
%<platexrelease|trace>    \@defaultunits\@tempdimb#2pt\relax\@nnil
%<platexrelease|trace>    \edef\f@size{\strip@pt\@tempdimb}%
%<platexrelease|trace>    \@defaultunits\@tempskipa#3pt\relax\@nnil
%<platexrelease|trace>    \edef\f@baselineskip{\the\@tempskipa}%
%<platexrelease|trace>    \edef\f@linespread{#1}%
%<platexrelease|trace>    \let\baselinestretch\f@linespread
%<platexrelease|trace>    \def\size@update{%
%<platexrelease|trace>      \baselineskip\f@baselineskip\relax
%<platexrelease|trace>      \baselineskip\f@linespread\baselineskip
%<platexrelease|trace>      \normalbaselineskip\baselineskip
%<platexrelease|trace>      \adjustbaseline
%<platexrelease|trace>      \setbox\strutbox\hbox{\yoko
%<platexrelease|trace>          \vrule\@width\z@
%<platexrelease|trace>                \@height.7\baselineskip \@depth.3\baselineskip}%
%<platexrelease|trace>      \setbox\tstrutbox\hbox{\tate
%<platexrelease|trace>          \vrule\@width\z@
%<platexrelease|trace>                \@height.5\baselineskip \@depth.5\baselineskip}%
%<platexrelease|trace>      \setbox\zstrutbox\hbox{\tate
%<platexrelease|trace>          \vrule\@width\z@
%<platexrelease|trace>                \@height.7\baselineskip \@depth.3\baselineskip}%
%<*trace>
%<platexrelease|trace>    \ifnum \tracingfonts>\tw@
%<platexrelease|trace>      \ifx\f@linespread\@empty
%<platexrelease|trace>        \let\reserved@a\@empty
%<platexrelease|trace>      \else
%<platexrelease|trace>        \def\reserved@a{\f@linespread x}%
%<platexrelease|trace>      \fi
%<platexrelease|trace>      \@font@info{Changing size to\space
%<platexrelease|trace>            \f@size/\reserved@a \f@baselineskip}%
%<platexrelease|trace>      \aftergroup\type@restoreinfo
%<platexrelease|trace>    \fi
%</trace>
%<platexrelease|trace>        \let\size@update\relax}}
%<platexrelease|trace>\plEndIncludeInRelease
%<*plcore|trace>
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{e-p\TeX{}でのFAM256パッチの利用}
%
% p\LaTeXe{}カーネル(2016/11/29)に導入したため削除。
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{改行}
%
% \begin{macro}{\@gnewline}
% \changes{v1.1c}{1995/08/25}{行頭禁則文字の直前での改行での不具合の修正}
% 日本語\TeX{}の行頭禁則処理は、禁則対象文字の直前に、
% |\prebreakpenalty|で指定されたペナルティの値を挿入することで
% 行なっています。
% ところが、改行コマンドは負のペナルティの値を挿入することで改行を行ないます。
% そのために、禁則ペナルティの値が$10000$の文字の直後では、ペナルティの値が
% 相殺され、改行することができません。
%
%\begin{verbatim}
% あいうえお\\
% ！かきくけこ
%\end{verbatim}
%
% したがって、|\newline|マクロに|\mbox{}|を入れることによって、
% |\newline|マクロのペナルティ$-10000$と行頭文字のペナルティ$10000$が
% 加算されないようにします。|\\|は|\newline|マクロを呼び出しています。
%
% なお、|\newline|マクロは\file{ltspaces.dtx}で定義されています。
%
% \changes{v1.1j}{1999/04/05}{オプションを付けた場合に、余計な空白
%    が入ってしまうのを修正。ありがとう、鈴木隆志＠京都大学さん。}
% \changes{v1.1h}{1997/06/25}{\LaTeX\ の改行マクロの変更に対応。
%    ありがとう、奥村さん。}
% \LaTeX\ \texttt{<1996/12/01>}で改行マクロが変更され、|\\|が
% |\newline|を呼び出さなくなったため、変更された改行マクロに対応しまし
% た。|\null|の挿入位置は同じです。
% \file{ltspace.dtx}の定義を上記に合わせて、定義しなおしました。
%
% \emph{日本語\TeX{}開発コミュニティによる補足}：
% アスキーによるp\LaTeX{}では、行頭禁則文字の直前で|\\|による強制改行を
% 行えるようにするという目的で
% |\null|を|\@gnewline|マクロ内に挿入していました。
% しかし、これでは|\\\par|と書いた場合にUnderfull警告が出なくなって
% います（|tests/newline_par.tex|を\texttt{latex}と\texttt{platex}で
% 処理してみてください）。
%
% もし|\null|の代わりに|\hskip\z@|を挿入すれば、\LaTeX{}と同様に
% Underfull警告を出すことができます。
% ただし、|\null|を挿入した場合と異なり、強制改行後の行頭に
% JFMグル―が入らなくなります。これはむしろ、奥村さんのjsclassesで
% 行頭を天ツキに直しているのと同じですが、p\LaTeX{}としては挙動が
% 変化してしまいますので、現時点では|\null|→|\hskip\z@|への変更を
% 見送っています。
% \changes{v1.2n}{2017/04/23}{ドキュメントの追加}
%
% もし変更するならば、以下のコードを有効にします。
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{????/??/??}{\@gnewline}
%<platexrelease>                   {Restore Underfull warning for |\\\par|}%
%<*plcore|platexrelease>
%\def\@gnewline #1{%
%  \ifvmode
%    \@nolnerr
%  \else
%    \unskip \reserved@e {\reserved@f#1}\nobreak \hfil \break \hskip \z@
%    \ignorespaces
%  \fi}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\@gnewline}
%<platexrelease>                   {Restore Underfull warning for |\\\par|}%
%<platexrelease>\def\@gnewline #1{%
%<platexrelease>  \ifvmode
%<platexrelease>    \@nolnerr
%<platexrelease>  \else
%<platexrelease>    \unskip \reserved@e {\reserved@f#1}\nobreak \hfil \break \null
%<platexrelease>    \ignorespaces
%<platexrelease>  \fi}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@no@lnbk}
% \emph{日本語\TeX{}開発コミュニティによる追加}：
% さらに、|\\|だけでなく|\linebreak|についても同様の対処をします。
% \LaTeX{}の定義のままではマクロによるペナルティ$-10000$と
% 行頭文字のペナルティ$10000$が加算されてしまうため、
% |\hskip\z@\relax|を入れておきます。なお、|\linebreak|を発行して
% 行分割が起きた場合、新しい行頭のJFMグル―は消えるという従来の
% p\LaTeX{}の挙動も維持しています。
% \changes{v1.2o}{2017/05/03}{行頭禁則文字の直前でも改行するようにした}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/05/05}{\@no@lnbk}
%<platexrelease>                   {Break before prebreakpenalty}%
%<*plcore|platexrelease>
\def\@no@lnbk #1[#2]{%
  \ifvmode
    \@nolnerr
  \else
    \@tempskipa\lastskip
    \unskip
    \penalty #1\@getpen{#2}%
    \hskip\z@\relax %% added (2017/05/03)
    \ifdim\@tempskipa>\z@
      \hskip\@tempskipa
      \ignorespaces
    \fi
  \fi}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\@no@lnbk}
%<platexrelease>                   {Break before prebreakpenalty}%
%<platexrelease>\def\@no@lnbk #1[#2]{%
%<platexrelease>  \ifvmode
%<platexrelease>    \@nolnerr
%<platexrelease>  \else
%<platexrelease>    \@tempskipa\lastskip
%<platexrelease>    \unskip
%<platexrelease>    \penalty #1\@getpen{#2}%
%<platexrelease>    \ifdim\@tempskipa>\z@
%<platexrelease>      \hskip\@tempskipa
%<platexrelease>      \ignorespaces
%<platexrelease>    \fi
%<platexrelease>  \fi}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{相互参照}
%
% \begin{macro}{\@setref}
% \changes{v1.1c}{1995/09/07}{change \cs{null} to \cs{relax} in \cs{@setref}.}
% \changes{v1.2k}{2017/02/20}{目次で\cs{ref}を使った場合に後ろの空白が消える
%    現象に対処するため、\cs{relax}のあとに\{\}を追加}
% |\ref|コマンドや|\pageref|コマンドで参照したとき、これらのコマンドに
% よって出力された番号と続く２バイト文字との間に|\xkanjiskip|が入りません。
% これは、|\null|が|\hbox{}|と定義されているためです。
% そこで|\null|を取り除きます。
% このコマンドは、\file{ltxref.dtx}で定義されているものです。
%
% しかし、単に|\null|を|\relax|に置き換えるだけでは、|\section|のような
% 「動く引数」で|\ref|などを使った場合に、目次で後ろの空白が消えてしまいます。
% そこで、|\relax|のあとに|{}|を追加しました。従来も|\protect\ref|のように使えば
% 問題ありませんでしたが、\LaTeX{}では展開されても問題が起きないrobustな実装に
% なっていますので、これに従います。
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\@setref}
%<platexrelease>                   {Spacing after \ref in moving arguments}%
%<*plcore|platexrelease>
\def\@setref#1#2#3{%
  \ifx#1\relax
    \protect\G@refundefinedtrue
    \nfss@text{\reset@font\bfseries ??}%
    \@latex@warning{Reference `#3' on page \thepage \space
              undefined}%
  \else
    \expandafter#2#1\relax{}% change \null to \relax{}
  \fi}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\@setref}
%<platexrelease>                   {Spacing after \ref in moving arguments}%
%<platexrelease>\def\@setref#1#2#3{%
%<platexrelease>  \ifx#1\relax
%<platexrelease>    \protect\G@refundefinedtrue
%<platexrelease>    \nfss@text{\reset@font\bfseries ??}%
%<platexrelease>    \@latex@warning{Reference `#3' on page \thepage \space
%<platexrelease>              undefined}%
%<platexrelease>  \else
%<platexrelease>    \expandafter#2#1\relax% change \null to \relax
%<platexrelease>  \fi}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{脚注とボトムフロートの順序および垂直位置}
%
% \begin{macro}{\@makecol}
% このマクロが組み立てる部分の中心となります。
% \file{ltoutput.dtx}で定義されているものです。
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\@makecol}{\@makecol}%
%<*plcore|platexrelease>
\gdef\@makecol{%
   \setbox\@outputbox\box\@cclv%
   \let\@elt\relax % added on LaTeX (ltoutput.dtx 2003/12/16 v1.2k)
   \xdef\@freelist{\@freelist\@midlist}%
   \global \let \@midlist \@empty
   \@combinefloats
%    \end{macrocode}
% オリジナルの\LaTeX{}は、トップフロート、本文、脚注、ボトムフロートの順番で
% 出力します。一方p\LaTeX{}は、トップフロート、本文、ボトムフロート、脚注の
% 順番で出力します。ところが、アスキー版のコードは順番を入れ替えるだけでなく、
% 版面全体の垂直位置が（特に縦組で顕著に）ずれてしまっていました。
% これは補正量|\dp\@outputbox|の取得が早すぎたためですので、コミュニティ版
% p\LaTeX{}ではこの問題に対処してあります。結果的に、fnposパッケージ(yafoot)の
% |\makeFNbottom|かつ|\makeFNbelow|な状態と完全に等価になりました。
% \changes{v1.2l}{2017/02/25}{脚注とボトムフロートの順序を入れ替えたことで
%    版面全体の垂直位置がずれていたのを修正(Issue 32)}
%    \begin{macrocode}
   \let\pltx@textbottom\@textbottom % save (pLaTeX 2017/02/25)
   \ifvoid\footins\else % changed (pLaTeX 2017/02/25)
     \setbox\@outputbox \vbox {%
       \boxmaxdepth \@maxdepth
       \unvbox \@outputbox
       \@textbottom % inserted here (pLaTeX 2017/02/25)
       \vskip \skip\footins
       \color@begingroup
         \normalcolor
         \footnoterule
         \unvbox \footins
       \color@endgroup
       }%
       \let\@textbottom\relax % disable temporarily (pLaTeX 2017/02/25)
   \fi
   \ifvbox\@kludgeins
     \@makespecialcolbox
   \else
     \setbox\@outputbox \vbox to\@colht {%
%       \boxmaxdepth \@maxdepth    % comment out on LaTeX 1997/12/01
       \@texttop
       \dimen@ \dp\@outputbox
       \unvbox \@outputbox
%    \end{macrocode}
% 縦組の際に|\@outputbox|の内容が空のボックスだけの場合に、|\wd\@outputbox|が
% 0ptになってしまい、結果としてフッタの位置がくるってしまっていた。
% 0の|\hskip|を発生させると|\wd\@outputbox|の値が期待したものとなるので、
% 縦組の場合はその方法で対処する。
%
% ただし、0の|\hskip|を発生させるとき、水平モードに入ってしまうと、たとえば
% longtableパッケージを使用して表組途中で改ページするときに|\par -> {\vskip}|の
% 無限ループが起きてしまいます。そこで、|\vbox|の中で発生させます。
% \changes{v1.1j}{2001/05/10}{\cs{@makecol}で組み立てられる
%    \cs{@outputbox}の大きさが、縦組で中身が空のボックスだけの場合も適正になる
%    ように修正}
% \changes{v1.2b}{2016/01/26}{\cs{@outputbox}の深さが他のものの位置に影響を与えない
%    ようにする\texttt{\cs{vskip}~-\cs{dimen@}}が縦組モードでは無効になっていたので修正}
% \changes{v1.2h}{2016/09/01}{縦組でlongtableパッケージを使って表組の途中で改ページ
%    するとき無限ループが起こる問題に対処(Issue 21)}
%    \begin{macrocode}
       \iftdir\vbox{\hskip\z@}\fi
       \vskip -\dimen@
       \@textbottom
       }%
   \fi
   \let\@textbottom\pltx@textbottom % restore (pLaTeX 2017/02/25)
   \global \maxdepth \@maxdepth
}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{2016/09/03}{\@makecol}{\@makecol}%
%<platexrelease>\gdef\@makecol{%
%<platexrelease>   \setbox\@outputbox\box\@cclv%
%<platexrelease>   \xdef\@freelist{\@freelist\@midlist}%
%<platexrelease>   \global \let \@midlist \@empty
%<platexrelease>   \@combinefloats
%<platexrelease>   \ifvbox\@kludgeins
%<platexrelease>     \@makespecialcolbox
%<platexrelease>   \else
%<platexrelease>     \setbox\@outputbox \vbox to\@colht {%
%<platexrelease>%       \boxmaxdepth \@maxdepth    % comment out on LaTeX 1997/12/01
%<platexrelease>       \@texttop
%<platexrelease>       \dimen@ \dp\@outputbox
%<platexrelease>       \unvbox \@outputbox
%<platexrelease>       \iftdir\vbox{\hskip\z@}\fi
%<platexrelease>       \vskip -\dimen@
%<platexrelease>       \@textbottom
%<platexrelease>       \ifvoid\footins\else % for pLaTeX
%<platexrelease>         \vskip \skip\footins
%<platexrelease>         \color@begingroup
%<platexrelease>            \normalcolor
%<platexrelease>            \footnoterule
%<platexrelease>            \unvbox \footins
%<platexrelease>         \color@endgroup
%<platexrelease>       \fi
%<platexrelease>       }%
%<platexrelease>   \fi
%<platexrelease>   \global \maxdepth \@maxdepth
%<platexrelease>}
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{2016/04/17}{\@makecol}{\@makecol}%
%<platexrelease>\gdef\@makecol{%
%<platexrelease>   \setbox\@outputbox\box\@cclv%
%<platexrelease>   \xdef\@freelist{\@freelist\@midlist}%
%<platexrelease>   \global \let \@midlist \@empty
%<platexrelease>   \@combinefloats
%<platexrelease>   \ifvbox\@kludgeins
%<platexrelease>     \@makespecialcolbox
%<platexrelease>   \else
%<platexrelease>     \setbox\@outputbox \vbox to\@colht {%
%<platexrelease>%       \boxmaxdepth \@maxdepth    % comment out on LaTeX 1997/12/01
%<platexrelease>       \@texttop
%<platexrelease>       \dimen@ \dp\@outputbox
%<platexrelease>       \unvbox \@outputbox
%<platexrelease>       \iftdir\hskip\z@\fi
%<platexrelease>       \vskip -\dimen@
%<platexrelease>       \@textbottom
%<platexrelease>       \ifvoid\footins\else % for pLaTeX
%<platexrelease>         \vskip \skip\footins
%<platexrelease>         \color@begingroup
%<platexrelease>            \normalcolor
%<platexrelease>            \footnoterule
%<platexrelease>            \unvbox \footins
%<platexrelease>         \color@endgroup
%<platexrelease>       \fi
%<platexrelease>       }%
%<platexrelease>   \fi
%<platexrelease>   \global \maxdepth \@maxdepth
%<platexrelease>}
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\@makecol}{\@makecol}%
%<platexrelease>\gdef\@makecol{%
%<platexrelease>   \setbox\@outputbox\box\@cclv%
%<platexrelease>   \xdef\@freelist{\@freelist\@midlist}%
%<platexrelease>   \global \let \@midlist \@empty
%<platexrelease>   \@combinefloats
%<platexrelease>   \ifvbox\@kludgeins
%<platexrelease>     \@makespecialcolbox
%<platexrelease>   \else
%<platexrelease>     \setbox\@outputbox \vbox to\@colht {%
%<platexrelease>%       \boxmaxdepth \@maxdepth    % comment out on LaTeX 1997/12/01
%<platexrelease>       \@texttop
%<platexrelease>       \dimen@ \dp\@outputbox
%<platexrelease>       \unvbox \@outputbox
%<platexrelease>       \iftdir\hskip\z@
%<platexrelease>       \else\vskip -\dimen@\fi
%<platexrelease>       \@textbottom
%<platexrelease>       \ifvoid\footins\else % for pLaTeX
%<platexrelease>         \vskip \skip\footins
%<platexrelease>         \color@begingroup
%<platexrelease>            \normalcolor
%<platexrelease>            \footnoterule
%<platexrelease>            \unvbox \footins
%<platexrelease>         \color@endgroup
%<platexrelease>       \fi
%<platexrelease>       }%
%<platexrelease>   \fi
%<platexrelease>   \global \maxdepth \@maxdepth
%<platexrelease>}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\@makespecialcolbox}
% 本文（あるいはボトムフロート）と脚注の間に|\@textbottom|を入れたいので、
% |\@makespecialcolbox|コマンドも修正をします。
% やはり、\file{ltoutput.dtx}で定義されているものです。
%
% このマクロは、|\enlargethispage|が使われたときに、
% |\@makecol|マクロから呼び出されます。
%
% \noindent\emph{日本語\TeX{}開発コミュニティによる補足(2017/02/25)}：
% 2016/11/29以前のp\LaTeX{}では、|\@makecol|はボトムフロートを挿入した後、
% すぐに|\@kludgeins|が空かどうか判定し
% \begin{itemize}
% \item 空の場合は、残りすべての処理を|\@makespecialcolbox|に任せる
% \item 空でない場合は、|\@makecol|自身で残りすべての処理を行う
% \end{itemize}
% としていました。しかし2017/04/08以降のp\LaTeX{}では、|\@makecol|はボトム
% フロートと脚注を挿入してから|\@kludgeins|の判定に移るようにしています。
% したがって、新しい|\@makecol|から以下に記す|\@makespecialcolbox|が呼び
% 出される場合は、|\ifvoid\footins|（二箇所）の判定は常に真となるはずです。
% 要するに「つぎの部分がp\LaTeX{}用の修正です。」という二箇所のコードは
% 実質的に不要となりました。
%
% しかし、だからといって消してしまうと、古いp\LaTeX{}の|\@makecol|を
% ベースに作られた外部パッケージから|\@makespecialcolbox|が呼び出される
% 場合に脚注が消滅するおそれがあります。このため、|\@makespecialcolbox|は
% 従来のコードのまま維持してあります（害はありません）。
% \changes{v1.2l}{2017/02/25}{\cs{@makecol}を変更したのに
%    \cs{@makespecialcolbox}を変更しない、という判断について明文化}
% （中略）
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% \section{下線マクロ}
%
% \begin{macro}{\textunderscore}
% \changes{v1.1b}{1995/04/12}{下線マクロを追加}
% このコマンドはテキストモードで指定された|\_|の内部コマンドです。
% 縦組での位置を調整するように再定義をします。
% もとは\file{ltoutenc.dtx}で定義されています。
%
% なお、|\_|を数式モードで使うと|\mathunderscore|が実行されます。
%
% コミュニティ版では縦数式ディレクションでベースライン補正量が
% 変だったのを直しました。あわせて横ディレクションでもベースライン
% 補正に追随するようにしています。
% \changes{v1.6g}{2017/03/07}{ベースライン補正量を修正}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\textunderscore}
%<platexrelease>                   {Baseline shift for \textunderscore}%
%<*plcore|platexrelease>
\DeclareTextCommandDefault{\textunderscore}{%
  \leavevmode\kern.06em
  \raise-\iftdir\ifmdir\ybaselineshift
         \else\tbaselineshift\fi
         \else\ybaselineshift\fi
  \vbox{\hrule\@width.3em}}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\textunderscore}
%<platexrelease>                   {Baseline shift for \textunderscore}%
%<platexrelease>\DeclareTextCommandDefault{\textunderscore}{%
%<platexrelease>  \leavevmode\kern.06em
%<platexrelease>  \iftdir\raise-\tbaselineshift\fi
%<platexrelease>  \vbox{\hrule\@width.3em}}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% ^^A ===== plcore.dtx (plcore) =====
% \section{verbatimとハイフネーション}
%
% \LaTeXe\ 2017-04-15で導入された疑似タイプ入力(verbatim)内での
% ハイフネーションに関連した修正に追随します。
%
% \begin{macro}{\@outputpage}
% |\textwidth|と|\textheight|の交換は、|\@shipoutsetup|内では行ないません。
% なぜなら、|\@shipoutsetup|マクロが実行されるときは、
% |\shipout|されるvboxの中であり、このときは横組モードですので、
% つねに|\iftdir|は偽と判断され、縦と横のサイズを交換できないからです。
%
% なお、この変更をローカルなものにするために、
% |\begingroup|と|\endgroup|で囲みます。
% \changes{v1.2a}{2001/09/26}{\LaTeX\ \texttt{!<2001/06/01!>}に対応}
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\@outputpage}
%<platexrelease>                   {Reset language for hyphenation}%
%<*plcore|platexrelease>
\def\@outputpage{%
\begingroup % the \endgroup is put in by \aftergroup
  \iftdir
    \dimen\z@\textwidth \textwidth\textheight \textheight\dimen\z@
  \fi
  \let \protect \noexpand
%    \end{macrocode}
% \LaTeXe\ 2017-04-15ではverbatim環境内でハイフネーションが起きないように
% 修正されましたが、verbatim環境の途中で改ページが起きた場合にヘッダで
% ハイフネーションが抑制されるのは正しくないので、|\language|を
% |\begin{document}|での値にリセットします（参考：latex2e svn r1407）。
% プリアンブルで特別に設定されればその値、設定されなければ0です（万が一
% |\document|の定義が古い場合\footnote{\LaTeXe\ 2017/01/01以前を使って
% p\LaTeXe{}のフォーマットを作成した場合や、dinbrief.clsのように独自の
% 再定義を行うクラスやパッケージを使った場合に起こるかもしれません。}は
% $-1$になりますが、これは0と同じはたらきをするので問題は起きません）。
% \changes{v1.2m}{2017/03/19}{\cs{language}をリセット
%    (sync with ltoutput.dtx 2017/03/10 v1.3c)}
%    \begin{macrocode}
  \language\document@default@language
  \@resetactivechars
  \global\let\@@if@newlist\if@newlist
  \global\@newlistfalse
  \@parboxrestore
  \shipout\vbox{\yoko
    \set@typeset@protect
    \aftergroup\endgroup
    \aftergroup\set@typeset@protect
%    \end{macrocode}
% \changes{v1.1g}{1998/02/03}{\cs{@shipoutsetup}を\cs{@outputpage}内に入れた}
% ここから|\@shipoutsetup|の内容。
%    \begin{macrocode}
     \if@specialpage
       \global\@specialpagefalse\@nameuse{ps@\@specialstyle}%
     \fi
%    \end{macrocode}
% \changes{v1.1c}{1995/02/05}{\cs{oddsidemargin}と\cs{evensidemargin}が
%    逆だったのを修正}
%    \begin{macrocode}
     \if@twoside
       \ifodd\count\z@ \let\@thehead\@oddhead \let\@thefoot\@oddfoot
          \iftdir\let\@themargin\evensidemargin
          \else\let\@themargin\oddsidemargin\fi
       \else \let\@thehead\@evenhead
          \let\@thefoot\@evenfoot
           \iftdir\let\@themargin\oddsidemargin
           \else\let\@themargin\evensidemargin\fi
     \fi\fi
%    \end{macrocode}
% トンボ出力オプションが指定されている場合、ここで用紙サイズを再設定します。
% \TeX の加える左と上部の1インチは、トンボの内側に入ります。
% \changes{v1.1a}{1995/11/10}{\cs{topmargin}が反映されないバグを修正}
%    \begin{macrocode}
     \@@topmargin\topmargin
     \iftombow
       \@@paperwidth\paperwidth \advance\@@paperwidth 6mm\relax
       \@@paperheight\paperheight \advance\@@paperheight 16mm\relax
       \advance\@@topmargin 1in\relax \advance\@themargin 1in\relax
     \fi
     \reset@font
     \normalsize
     \normalsfcodes
     \let\label\@gobble
     \let\index\@gobble
     \let\glossary\@gobble
     \baselineskip\z@skip \lineskip\z@skip \lineskiplimit\z@
%    \end{macrocode}
% ここまでが|\@shipoutsetup|の内容。
%    \begin{macrocode}
    \@begindvi
    \@outputtombow
    \vskip \@@topmargin
    \moveright\@themargin\vbox{%
      \setbox\@tempboxa \vbox to\headheight{%
        \vfil
        \color@hbox
          \normalcolor
          \hb@xt@\textwidth{\@thehead}%
        \color@endbox
      }%                        %% 22 Feb 87
      \dp\@tempboxa \z@
      \box\@tempboxa
      \vskip \headsep
      \box\@outputbox
      \baselineskip \footskip
      \color@hbox
        \normalcolor
        \hb@xt@\textwidth{\@thefoot}%
      \color@endbox
    }%
  }%
%  \endgroup now inserted by \aftergroup
%    \end{macrocode}
% |\if@newlist|を初期化。
%    \begin{macrocode}
  \global\let\if@newlist\@@if@newlist
  \global \@colht \textheight
  \stepcounter{page}%
  \let\firstmark\botmark
}
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\@outputpage}
%<platexrelease>                   {Reset language for hyphenation}%
%<platexrelease>\def\@outputpage{%
%<platexrelease>\begingroup % the \endgroup is put in by \aftergroup
%<platexrelease>  \iftdir
%<platexrelease>    \dimen\z@\textwidth \textwidth\textheight \textheight\dimen\z@
%<platexrelease>  \fi
%<platexrelease>  \let \protect \noexpand
%<platexrelease>  \@resetactivechars
%<platexrelease>  \global\let\@@if@newlist\if@newlist
%<platexrelease>  \global\@newlistfalse
%<platexrelease>  \@parboxrestore
%<platexrelease>  \shipout\vbox{\yoko
%<platexrelease>    \set@typeset@protect
%<platexrelease>    \aftergroup\endgroup
%<platexrelease>    \aftergroup\set@typeset@protect
%<platexrelease>     \if@specialpage
%<platexrelease>       \global\@specialpagefalse\@nameuse{ps@\@specialstyle}%
%<platexrelease>     \fi
%<platexrelease>     \if@twoside
%<platexrelease>       \ifodd\count\z@ \let\@thehead\@oddhead \let\@thefoot\@oddfoot
%<platexrelease>          \iftdir\let\@themargin\evensidemargin
%<platexrelease>          \else\let\@themargin\oddsidemargin\fi
%<platexrelease>       \else \let\@thehead\@evenhead
%<platexrelease>          \let\@thefoot\@evenfoot
%<platexrelease>           \iftdir\let\@themargin\oddsidemargin
%<platexrelease>           \else\let\@themargin\evensidemargin\fi
%<platexrelease>     \fi\fi
%<platexrelease>     \@@topmargin\topmargin
%<platexrelease>     \iftombow
%<platexrelease>       \@@paperwidth\paperwidth \advance\@@paperwidth 6mm\relax
%<platexrelease>       \@@paperheight\paperheight \advance\@@paperheight 16mm\relax
%<platexrelease>       \advance\@@topmargin 1in\relax \advance\@themargin 1in\relax
%<platexrelease>     \fi
%<platexrelease>     \reset@font
%<platexrelease>     \normalsize
%<platexrelease>     \normalsfcodes
%<platexrelease>     \let\label\@gobble
%<platexrelease>     \let\index\@gobble
%<platexrelease>     \let\glossary\@gobble
%<platexrelease>     \baselineskip\z@skip \lineskip\z@skip \lineskiplimit\z@
%<platexrelease>    \@begindvi
%<platexrelease>    \@outputtombow
%<platexrelease>    \vskip \@@topmargin
%<platexrelease>    \moveright\@themargin\vbox{%
%<platexrelease>      \setbox\@tempboxa \vbox to\headheight{%
%<platexrelease>        \vfil
%<platexrelease>        \color@hbox
%<platexrelease>          \normalcolor
%<platexrelease>          \hb@xt@\textwidth{\@thehead}%
%<platexrelease>        \color@endbox
%<platexrelease>      }%                        %% 22 Feb 87
%<platexrelease>      \dp\@tempboxa \z@
%<platexrelease>      \box\@tempboxa
%<platexrelease>      \vskip \headsep
%<platexrelease>      \box\@outputbox
%<platexrelease>      \baselineskip \footskip
%<platexrelease>      \color@hbox
%<platexrelease>        \normalcolor
%<platexrelease>        \hb@xt@\textwidth{\@thefoot}%
%<platexrelease>      \color@endbox
%<platexrelease>    }%
%<platexrelease>  }%
%<platexrelease>  \global\let\if@newlist\@@if@newlist
%<platexrelease>  \global \@colht \textheight
%<platexrelease>  \stepcounter{page}%
%<platexrelease>  \let\firstmark\botmark
%<platexrelease>}
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% \subsection{疑似タイプ入力}
%
% \begin{macro}{\verb}
% \changes{v1.1b}{1995/04/05}{互換モードのときは、pl209.defの定義を使う}
% \changes{v1.1g}{1997/01/16}
%    {\cs{verb}コマンドを\LaTeX\ \texttt{!<1996/06/01!>}に合わせて修正}
% \LaTeX{}の|\verb|コマンドでは、数式モードでないときは、
% |\leavevmode|で水平モードに入ったあと、|\null|を出力しています。
% マクロ|\null|は|\hbox{}|として定義されていますので、
% ここには和欧文間スペース（|\xkanjiskip|）が入りません。
% そこで、|\null|を出力しないようマクロを修正します。
% このマクロは、\file{ltmiscen.dtx}で定義されています。
%    \begin{macrocode}
%<platexrelease>\plIncludeInRelease{2017/04/08}{\verb}
%<platexrelease>                   {Disable hyphenation in verb}%
%<*plcore|platexrelease>
\if@compatibility\else
\def\verb{\relax\ifmmode\hbox\else\leavevmode\fi
  \bgroup
    \verb@eol@error \let\do\@makeother \dospecials
    \verbatim@font\@noligs
%    \end{macrocode}
% \LaTeXe\ 2017-04-15に追随して、|\verb|の途中でハイフネーションが起きない
% ように|\language|を設定します（参考：latex2e svn r1405）。
% \changes{v1.2m}{2017/03/19}{\cs{verb}の途中でハイフネーションが起きない
%    ように\cs{language}を設定(sync with ltmiscen.dtx 2017/03/09 v1.1m)}
%    \begin{macrocode}
    \language\l@nohyphenation
    \@ifstar\@sverb\@verb}
\fi
%</plcore|platexrelease>
%<platexrelease>\plEndIncludeInRelease
%<platexrelease>\plIncludeInRelease{0000/00/00}{\verb}
%<platexrelease>                   {Disable hyphenation in verb}%
%<platexrelease>\if@compatibility\else
%<platexrelease>\def\verb{\relax\ifmmode\hbox\else\leavevmode\fi
%<platexrelease>  \bgroup
%<platexrelease>    \verb@eol@error \let\do\@makeother \dospecials
%<platexrelease>    \verbatim@font\@noligs
%<platexrelease>    \@ifstar\@sverb\@verb}
%<platexrelease>\fi
%<platexrelease>\plEndIncludeInRelease
%    \end{macrocode}
% \end{macro}
%
% ^^A ===== plvers.dtx (plfinal) =====
% \subsection{ハイフネーション関連}
%
% \begin{macro}{\l@nohyphenation}
% \LaTeXe\ 2017-04-15で、|\verb|の途中でハイフネーションが起きないように
% する修正が入りました。この修正には|\l@nohyphenation|が定義済みでなければ
% なりませんが、通常はBabelの定義ファイルによって提供されています。
% \LaTeXe{}は特殊な状況も想定してltfinalで対策しているようですので、
% p\LaTeXe{}も念のためplfinalで対策します（参考：latex2e svn r1405）。
% \changes{v1.1b}{2017/03/19}{\cs{l@nohyphenation}の定義を保証
%    (sync with ltfinal 2017/03/09 v2.0t)}
%    \begin{macrocode}
%<*plfinal>
\ifx\l@nohyphenation \@undefined
  \newlanguage\l@nohyphenation
\fi
%    \end{macrocode}
% \end{macro}
%
% \begin{macro}{\document@default@language}
% \LaTeXe\ 2017-04-15で導入されたパラメータです。更新タイミングのずれの
% 可能性を考慮し、p\LaTeXe{}でも準備しておきます。verbatim環境の途中で
% 改ページが起きた場合にヘッダでハイフネーションが抑制されないように、
% |\@outputpage|で|\language|をリセットするときに使われます
% （参考：latex2e svn r1407）。
% \changes{v1.1b}{2017/03/19}{\cs{document@default@language}の定義を保証
%    (sync with ltfinal 2017/03/09 v2.0t)}
%    \begin{macrocode}
\ifx\document@default@language \@undefined
  \let\document@default@language\m@ne
\fi
%</plfinal>
%    \end{macrocode}
% \end{macro}
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
\endinput
